!function(t){"use strict";if("function"==typeof define&&define.amd)define(["jquery","Cookies"],t);else if("object"==typeof exports)module.exports=t();else{var e=window.Lang,n=window.Lang=t(jQuery,"undefined"!=typeof Cookies?Cookies:void 0);n.noConflict=function(){return window.Lang=e,n}}}(function(t,e){var n=function(){this._fireEvents=!0,this._dynamic={}};return n.prototype.init=function(n){var a,i,o,r,s=this;(n=n||{}).cookie=n.cookie||{},i=n.defaultLang,o=n.currentLang,r=n.allowCookieOverride,this.cookieName=n.cookie.name||"langCookie",this.cookieExpiry=n.cookie.expiry||365,this.cookiePath=n.cookie.path||"/",this._mutationCopies={append:t.fn.append,appendTo:t.fn.appendTo,prepend:t.fn.prepend,before:t.fn.before,after:t.fn.after,html:t.fn.html},t.fn.append=function(){return s._mutation(this,"append",arguments)},t.fn.appendTo=function(){return s._mutation(this,"appendTo",arguments)},t.fn.prepend=function(){return s._mutation(this,"prepend",arguments)},t.fn.before=function(){return s._mutation(this,"before",arguments)},t.fn.after=function(){return s._mutation(this,"after",arguments)},t.fn.html=function(){return s._mutation(this,"html",arguments)},this.defaultLang=i||"en",this.currentLang=i||"en",!r&&o||void 0===e||(a=e.get(this.cookieName))&&(o=a),t(function(){s._start(),o&&o!==s.defaultLang&&s.change(o)})},n.prototype.pack={},n.prototype.attrList=["title","alt","placeholder","href"],n.prototype.dynamic=function(t,e){void 0!==t&&void 0!==e&&(this._dynamic[t]=e)},n.prototype.loadPack=function(e,n){var a=this;if(!e||!a._dynamic[e])throw"Cannot load language pack, no file path specified!";t.ajax({dataType:"json",url:a._dynamic[e],success:function(t){if(a.pack[e]=t,a.pack[e].regex){var i,o,r=a.pack[e].regex;for(o=0;o<r.length;o++)2===(i=r[o]).length?i[0]=new RegExp(i[0]):3===i.length&&(i[0]=new RegExp(i[0],i[1]),i.splice(1,1))}n&&n(!1,e,a._dynamic[e])},error:function(){throw n&&n(!0,e,a._dynamic[e]),"Error loading language pack"+a._dynamic[e]}})},n.prototype._start=function(e){for(var n,a=void 0!==e?t(e).find("[lang]"):t(":not(html)[lang]"),i=a.length;i--;)n=t(a[i]),this._processElement(n)},n.prototype._processElement=function(t){t.attr("lang")===this.defaultLang&&(this._storeAttribs(t),this._storeContent(t))},n.prototype._storeAttribs=function(t){var e,n,a;for(e=0;e<this.attrList.length;e++)n=this.attrList[e],t.attr(n)&&((a=t.data("lang-attr")||{})[n]=t.attr(n),t.data("lang-attr",a))},n.prototype._storeContent=function(t){if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":t.data("lang-val",t.val())}else if(t.is("img"))t.data("lang-src",t.attr("src"));else{var e=this._getTextNodes(t);e&&t.data("lang-text",e)}},n.prototype._getTextNodes=function(e){var n=e.contents(),a=[],i={};Array.prototype.map;return t.each(n,function(t,e){3===e.nodeType&&(i={node:e,langDefaultText:e.data},a.push(i))}),1==n.length&&(a[0].langToken=e.data("langToken")),a},n.prototype._setTextNodes=function(e,n,a){var i,o,r,s,c=a!==this.defaultLang;for(i=0;i<n.length;i++)if(o=n[i],c){if(r=o.langToken||t.trim(o.langDefaultText))if(s=this.translate(r,a),/<[^>]+>/g.test(s))e.context.innerHTML=s;else if(s)try{o.node.data=o.node.data.split(t.trim(o.node.data)).join(s)}catch(t){}else console&&console.log&&console.log('Translation for "'+r+'" not found!')}else try{o.node.data=o.langDefaultText}catch(t){}},n.prototype._translateAttribs=function(t,e){var n,a,i=t.data("lang-attr")||{};for(n in i)i.hasOwnProperty(n)&&t.attr(n)&&(e!==this.defaultLang?(a=this.translate(i[n],e))&&t.attr(n,a):t.attr(n,i[n]))},n.prototype._translateContent=function(t,e){var n,a,i=e!==this.defaultLang;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":i?(n=this.translate(t.data("lang-val"),e))&&t.val(n):t.val(t.data("lang-val"))}else t.is("img")?i?(n=this.translate(t.data("lang-src"),e))&&t.attr("src",n):t.attr("src",t.data("lang-src")):(a=t.data("lang-text"))&&this._setTextNodes(t,a,e)},n.prototype.change=function(n,a,i){var o=this;if(n!==this.defaultLang&&!this.pack[n]&&!this._dynamic[n])throw i&&i("No language pack defined for: "+n,n,a),'Attempt to change language to "'+n+'" but no language pack for that language is loaded!';if(n!==this.defaultLang){if(!this.pack[n]&&this._dynamic[n])return void this.loadPack(n,function(t,e,r){t?i&&i("Language pack could not load from: "+r,n,a):o.change.call(o,n,a,i)});if(!this.pack[n]&&!this._dynamic[n])throw i&&i("Language pack not defined for: "+n,n,a),"Could not change language to "+n+" because no language pack for this language exists!"}var r=!1,s=this.currentLang;this.currentLang!=n&&(this.beforeUpdate(s,n),r=!0),this.currentLang=n;for(var c,l=void 0!==a?t(a).find("[lang]"):t(":not(html)[lang]"),f=l.length;f--;)(c=t(l[f])).attr("lang")!==n&&this._translateElement(c,n);r&&this.afterUpdate(s,n),void 0!==e&&e.set(o.cookieName,n,{expires:o.cookieExpiry,path:o.cookiePath}),i&&i(!1,n,a)},n.prototype._translateElement=function(t,e){this._translateAttribs(t,e),"false"!=t.attr("data-lang-content")&&this._translateContent(t,e),t.attr("lang",e)},n.prototype.translate=function(t,e){if(e=e||this.currentLang,this.pack[e]){var n="";return e!=this.defaultLang?((n=this.pack[e].token[t])||(n=this._regexMatch(t,e)),n||console&&console.log&&console.log('Translation for "'+t+'" not found in language pack: '+e),n||t):t}return t},n.prototype._regexMatch=function(t,e){var n,a,i,o,r;if(n=this.pack[e].regex)for(a=n.length,i=0;i<a;i++)if((r=(o=n[i])[0].exec(t))&&r[0])return t.split(r[0]).join(o[1]);return""},n.prototype.beforeUpdate=function(e,n){this._fireEvents&&t(this).triggerHandler("beforeUpdate",[e,n,this.pack[e],this.pack[n]])},n.prototype.afterUpdate=function(e,n){this._fireEvents&&t(this).triggerHandler("afterUpdate",[e,n,this.pack[e],this.pack[n]])},n.prototype.refresh=function(){this._fireEvents=!1,this.change(this.currentLang),this._fireEvents=!0},n.prototype._mutation=function(e,n,a){var i=this._mutationCopies[n].apply(e,a),o=this.currentLang,r=t(e);return r.attr("lang")&&(this._fireEvents=!1,this._translateElement(r,this.defaultLang),this.change(this.defaultLang,r),this.currentLang=o,this._processElement(r),this._translateElement(r,this.currentLang)),this._start(r),this.change(this.currentLang,r),this._fireEvents=!0,i},n});
